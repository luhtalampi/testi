<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <title>Planning Bulloarvonta</title>
  <style>
    html, body {
      height: 100%;
      margin: 0; padding: 0;
      background: #fdf6e3;
      font-family: Arial, sans-serif;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
    }

    body {
      width: 100vw;
      height: 100vh;
      padding: 1vh 2vw;
      display: flex;
      gap: 2vw;
      overflow: hidden;
    }

    section {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgb(166 124 0 / 0.3);
      padding: 25px 30px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }

    #inputSection, #hallOfFameSection {
      flex: 1;
      min-width: 320px;
      max-height: 95vh;
      overflow-y: auto;
    }

    #bottleSection {
      flex: 0 0 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      max-height: 100vh;
      position: relative;
    }

    #bottleSection h2 {
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.5em;
      color: #a67c00;
      user-select: none;
    }

    #bottle {
      position: relative;
      width: 400px;
      height: 1000px;
      background-image: url('https://i.imgur.com/BE7jpgZ.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center bottom;
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      padding-bottom: 160px;
      user-select: none;
    }

#bottle-label {
  position: absolute;
  bottom: 85px; /* <-- muuta t√§t√§ arvoa nostaa/laskemaan etiketti√§ */
  left: 50%;
  transform: translateX(-50%);
  width: 160px; /* <-- muuta t√§t√§ arvoa etiketin levent√§miseen/kaventamiseen */
  height: 110px;
  background: transparent;
  padding: 10px 15px;
  font-size: 0.85em;
  font-weight: 600;
  color: #a67c00;
  overflow-wrap: break-word;
  white-space: normal;
  text-align: center;
  user-select: text;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-content: center;
}



    textarea {
      width: 100%;
      height: 40vh;
      font-size: 18px;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #ccc;
      resize: vertical;
      box-sizing: border-box;
      font-weight: 600;
      user-select: text;
    }

    button {
      margin: 15px 10px 15px 0;
      background: #a67c00;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 14px 28px;
      font-weight: 700;
      font-size: 1.1em;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
    }

    button:disabled {
      background: #c7b07f;
      cursor: not-allowed;
    }

    button:hover:not(:disabled) {
      background-color: #d8aa00;
    }

    li {
      background-color: rgba(255, 255, 255, 0.95);
      color: orange;
      padding: 16px 25px;
      margin: 10px 0;
      border-radius: 50px;
      text-align: center;
      font-weight: 800;
      font-size: 1.4em;
      box-shadow: 0 4px 10px rgba(180, 140, 0, 0.7);
      user-select: none;
    }

    #winnerPopup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3em;
      font-weight: bold;
      color: #ff9800;
      text-shadow: 2px 2px 10px #000;
      z-index: 9999;
      display: none;
      animation: popIn 0.6s ease-out;
    }

    @keyframes popIn {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }

    #hallOfFameTable {
      width: 100%;
      border-collapse: collapse;
    }

    #hallOfFameTable th, #hallOfFameTable td {
      padding: 8px 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      user-select: text;
    }

    .deleteBtn {
      color: red;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>

<section id="inputSection">
  <h1>Lis√§√§ nimet</h1>
  <textarea id="namesInput" placeholder="Esim. Matti&#10;Maija&#10;Kalle"></textarea>
  <button onclick="moveToBottle()">Siirr√§ pulloon</button>
  <button onclick="startDraw()" id="drawBtn" disabled>Aloita arvonta</button>
</section>

<section id="bottleSection">
  <h2>Planning Bulloarvonta</h2>
  <div id="bottle">
    <div id="bottle-label"></div>
  </div>
</section>

<section id="hallOfFameSection">
  <h2>Hall of Fame</h2>
  <table id="hallOfFameTable">
    <thead><tr><th>Voittaja</th><th>Kuukausi/Vuosi</th><th></th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<div id="winnerPopup"></div>

<script>
let names = [];
let lastWinner = null;

const finnishMonths = ["Tammikuu", "Helmikuu", "Maaliskuu", "Huhtikuu", "Toukokuu", "Kes√§kuu", "Hein√§kuu", "Elokuu", "Syyskuu", "Lokakuu", "Marraskuu", "Joulukuu"];

function moveToBottle() {
  const input = document.getElementById('namesInput').value.split('\n').map(n => n.trim()).filter(Boolean);
  if (input.length === 0) return alert("Sy√∂t√§ ainakin yksi nimi");
  names = input;
  renderNames();
  document.getElementById('drawBtn').disabled = false;
}

function renderNames() {
  const label = document.getElementById('bottle-label');
  label.innerHTML = '';
  names.forEach(name => {
    const textNode = document.createTextNode(name + ' ');
    label.appendChild(textNode);
  });
}

function startDraw() {
  if(names.length === 0) return;
  document.getElementById('drawBtn').disabled = true;

  const interval = setInterval(() => {
    if (names.length === 3) {
      // Kolmanneksi viimeinen tippuu pois, joten ensin poista nimi:
      const indexToRemove = Math.floor(Math.random() * names.length);
      names.splice(indexToRemove, 1);
      renderNames();

      // 1,5 sekunnin viive, sitten n√§ytet√§√§n "Finaali alkaa!"
      setTimeout(() => {
        const finalMsg = document.createElement('div');
        finalMsg.textContent = "üèÜ Finaali alkaa!";
        finalMsg.style.position = 'fixed';
        finalMsg.style.top = '50%';
        finalMsg.style.left = '50%';
        finalMsg.style.transform = 'translate(-50%, -50%)';
        finalMsg.style.fontSize = '3em';
        finalMsg.style.fontWeight = 'bold';
        finalMsg.style.background = 'rgba(0,0,0,0.7)';
        finalMsg.style.color = 'white';
        finalMsg.style.padding = '20px 40px';
        finalMsg.style.borderRadius = '15px';
        finalMsg.style.zIndex = '9999';
        document.body.appendChild(finalMsg);

        // N√§ytet√§√§n finaaliteksti 2,5 sekuntia
        setTimeout(() => {
          finalMsg.remove();

          // Odotetaan viel√§ 2,5 sekuntia ennen voittajan selvi√§mist√§
          setTimeout(() => {
            if (names.length === 2) {
              // Poistetaan satunnainen h√§vi√§j√§ viimeisen karsinnan j√§lkeen
              const loserIndex = Math.floor(Math.random() * names.length);
              names.splice(loserIndex, 1);
              renderNames();

              // N√§ytet√§√§n voittaja
              const winner = names[0];
              showWinner(winner);
            }
          }, 2500);

        }, 2500);
      }, 1500);

      clearInterval(interval);
      return;
    }

    if (names.length <= 1) {
      clearInterval(interval);
      if (names.length === 1) showWinner(names[0]);
      return;
    }
    
    // Poistetaan satunnainen nimi normaalisti
    const index = Math.floor(Math.random() * names.length);
    names.splice(index, 1);
    renderNames();
  }, 3000);
}

function showWinner(name) {
  lastWinner = name;
  const popup = document.getElementById('winnerPopup');
  popup.textContent = `üéâ Voittaja on ${name}! üéâ`;
  popup.style.display = 'block';

  const interval = setInterval(() => {
    const emojis = ['üéá','üéÜ','‚ú®','üî•'];
    const e = document.createElement('div');
    e.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    e.style.position = 'fixed';
    e.style.left = `${Math.random() * 100}vw`;
    e.style.top = `${Math.random() * 100}vh`;
    e.style.fontSize = '2em';
    e.style.animation = 'fade 2s forwards';
    document.body.appendChild(e);
    setTimeout(() => e.remove(), 2000);
  }, 200);

  setTimeout(() => clearInterval(interval), 4000);

  saveToHallOfFame();
}

function saveToHallOfFame() {
  if (!lastWinner) return;
  const now = new Date();
  const dateStr = `${finnishMonths[now.getMonth()]} ${now.getFullYear()}`;
  const table = document.querySelector('#hallOfFameTable tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${lastWinner}</td><td>${dateStr}</td><td><span class="deleteBtn" onclick="deleteRow(this, '${lastWinner}', '${dateStr}')">Poista</span></td>`;
  table.prepend(tr);

  const data = JSON.parse(localStorage.getItem('hallOfFameWinners') || '[]');
  data.unshift({ name: lastWinner, date: dateStr });
  localStorage.setItem('hallOfFameWinners', JSON.stringify(data));
}

function deleteRow(el, name, date) {
  const row = el.closest('tr');
  row.remove();
  let data = JSON.parse(localStorage.getItem('hallOfFameWinners') || '[]');
  data = data.filter(entry => !(entry.name === name && entry.date === date));
  localStorage.setItem('hallOfFameWinners', JSON.stringify(data));
}

function loadHallOfFame() {
  const data = JSON.parse(localStorage.getItem('hallOfFameWinners') || '[]');
  const table = document.querySelector('#hallOfFameTable tbody');
  table.innerHTML = '';
  data.forEach(row => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${row.name}</td><td>${row.date}</td><td><span class="deleteBtn" onclick="deleteRow(this, '${row.name}', '${row.date}')">Poista</span></td>`;
    table.appendChild(tr);
  });
}

loadHallOfFame();
</script>

</body>
</html>




 






